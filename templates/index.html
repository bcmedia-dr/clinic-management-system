<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bcmedia è¨ºæ‰€ç®¡ç†ç³»çµ±</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 40px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            font-size: 32px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
        }

        .nav {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s;
            cursor: pointer;
            display: inline-block;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .nav-btn.active {
            background: white;
            color: #667eea;
            border-color: white;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-logout {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .stat-card.total {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .stat-card.health-mall-yes {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .stat-card.health-mall-no {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .stat-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .stat-title {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .stat-number {
            font-size: 36px;
            font-weight: 700;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }

        .controls-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            font-family: 'Noto Sans TC', sans-serif;
        }

        .filter-select {
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            font-family: 'Noto Sans TC', sans-serif;
            background: white;
            cursor: pointer;
        }

        .btn-add {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-add:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-export, .btn-import {
            background: #4ade80;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-export:hover, .btn-import:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 222, 128, 0.3);
        }

        .btn-import {
            background: #fb923c;
        }

        .btn-import:hover {
            box-shadow: 0 5px 15px rgba(251, 146, 60, 0.3);
        }

        .btn-delete-batch {
            background: #f5576c;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-delete-batch:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.3);
        }

        .checkbox-select {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .table-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            overflow-x: auto; /* å…è¨±æ©«å‘æ»¾å‹•ä»¥é¡¯ç¤ºæ‰€æœ‰åˆ— */
            overflow-y: visible;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            min-width: 1350px; /* ç¢ºä¿è¡¨æ ¼æœ‰è¶³å¤ å¯¬åº¦ */
        }
        
        .table-container {
            overflow-x: auto; /* å…è¨±æ©«å‘æ»¾å‹• */
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th {
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            white-space: nowrap;
        }

        th:nth-child(1) { width: 50px; }  /* é¸æ“‡ */
        th:nth-child(2) { width: 50px; }  /* ç·¨è™Ÿ */
        th:nth-child(3) { width: 70px; }  /* ç¸£å¸‚ */
        th:nth-child(4) { width: 70px; }  /* å€åŸŸ */
        th:nth-child(5) { width: 150px; } /* è¨ºæ‰€åç¨± */
        th:nth-child(6) { width: 140px; } /* ç§‘åˆ¥ */
        th:nth-child(7) { width: 120px; } /* é›»è©± */
        th:nth-child(8) { width: 100px; } /* è² è²¬äºº */
        th:nth-child(9) { width: 150px; } /* åª’é«”é …ç›® */
        th:nth-child(10) { width: 90px; }  /* å¥åº·é†«è³¼ */
        th:nth-child(11) { width: 70px; }  /* ç™¾ä½ */
        th:nth-child(12) { width: 150px; min-width: 150px; } /* æ“ä½œ */

        td {
            padding: 12px 10px;
            border-bottom: 1px solid #f0f0f0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            vertical-align: middle;
        }

        td:nth-child(4) { /* è¨ºæ‰€åç¨± */
            font-weight: 600;
        }

        /* ç¢ºä¿æ‰€æœ‰æ¬„ä½éƒ½æœ‰é©ç•¶çš„ tooltip */
        td[title] {
            cursor: help;
        }

        tbody tr {
            transition: all 0.2s;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge.yes {
            background: #d4edda;
            color: #155724;
        }

        .badge.no {
            background: #f8d7da;
            color: #721c24;
        }

        .btn-edit, .btn-delete, .btn-detail {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            margin-right: 4px;
            transition: all 0.2s;
            white-space: nowrap;
            min-width: 55px;
            text-align: center;
            color: white;
            display: inline-block;
            flex-shrink: 0;
        }

        td:nth-child(6) { /* ç§‘åˆ¥ */
            white-space: normal;
            overflow: visible;
        }

        td:nth-child(9) { /* åª’é«”é …ç›® */
            white-space: normal;
            overflow: visible;
        }

        td:nth-child(12) { /* æ“ä½œæ¬„ä½ */
            white-space: nowrap;
            overflow: visible;
            padding: 12px 8px;
        }
        
        /* ç¢ºä¿æ“ä½œåˆ—æŒ‰éˆ•å®¹å™¨æœ‰è¶³å¤ ç©ºé–“ */
        td:nth-child(12) button:last-child {
            margin-right: 0;
        }

        .btn-edit {
            background: #4facfe;
        }

        .btn-edit:hover {
            background: #3a8fd9;
        }

        .btn-delete {
            background: #f5576c;
        }

        .btn-delete:hover {
            background: #d63f52;
        }

        .btn-detail {
            background: #4ade80;
        }

        .btn-detail:hover {
            background: #22c55e;
        }

        .detail-row {
            display: none;
        }

        .detail-row.active {
            display: table-row;
        }

        .detail-content {
            padding: 15px 20px;
            background: #f8f9fa;
            border-left: 4px solid #4ade80;
        }

        .detail-content h4 {
            margin-bottom: 12px;
            color: #333;
            font-size: 14px;
            font-weight: 600;
        }

        .detail-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            padding: 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .detail-item label {
            font-weight: 600;
            color: #6b7280;
            font-size: 12px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-item span {
            color: #111827;
            font-size: 14px;
            line-height: 1.5;
            word-break: break-word;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            max-width: 600px;
            margin: 50px auto;
            border-radius: 20px;
            padding: 30px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-header h2 {
            font-size: 24px;
            color: #333;
        }

        .close-btn {
            font-size: 28px;
            cursor: pointer;
            color: #999;
            background: none;
            border: none;
        }

        .close-btn:hover {
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            font-family: 'Noto Sans TC', sans-serif;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 400;
            cursor: pointer;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            cursor: pointer;
        }

        .btn-submit {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .specialty-tag {
            display: inline-block;
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
            margin: 2px 2px 2px 0;
            white-space: nowrap;
        }
        
        .status-tag {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .status-tag.yes {
            background: #d4edda;
            color: #155724;
        }
        
        .status-tag.no {
            background: #f8d7da;
            color: #721c24;
        }

    </style>
</head>
<body>
    <div class="header">
        <div class="header-top">
            <div class="header-left">
                <div class="logo">ğŸ¥</div>
                <h1>Bcmedia è¨ºæ‰€ç®¡ç†ç³»çµ±</h1>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <span>ğŸ‘¤</span>
                    <span id="username"></span>
                </div>
                <button class="btn-logout" onclick="logout()">ğŸšª ç™»å‡º</button>
            </div>
        </div>
        <div class="nav">
            <a href="/" class="nav-btn active">ğŸ“‹ è¨ºæ‰€ç®¡ç†</a>
            <a href="/analytics" class="nav-btn">ğŸ“Š çµ±è¨ˆåˆ†æ</a>
        </div>
    </div>

    <div class="container">
        <div class="stats">
            <div class="stat-card total">
                <div class="stat-icon">ğŸ¥</div>
                <div class="stat-title">ç¸½è¨ºæ‰€æ•¸</div>
                <div class="stat-number" id="totalClinics">0</div>
            </div>
            <div class="stat-card health-mall-yes">
                <div class="stat-icon">âœ…</div>
                <div class="stat-title">å¥åº·é†«è³¼</div>
                <div class="stat-number" id="healthMallYes">0</div>
            </div>
            <div class="stat-card health-mall-no">
                <div class="stat-icon">ğŸ“Š</div>
                <div class="stat-title">éå¥åº·é†«è³¼</div>
                <div class="stat-number" id="healthMallNo">0</div>
            </div>
        </div>

        <div class="controls">
            <div class="controls-row">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="ğŸ” æœå°‹è¨ºæ‰€åç¨±ã€åœ°å€ã€è² è²¬äºº...">
                </div>
                <select class="filter-select" id="filterRegion">
                    <option value="">è«‹é¸æ“‡åœ°å€</option>
                    <option value="è‡ºåŒ—å¸‚">è‡ºåŒ—å¸‚</option>
                    <option value="æ–°åŒ—å¸‚">æ–°åŒ—å¸‚</option>
                    <option value="æ¡ƒåœ’å¸‚">æ¡ƒåœ’å¸‚</option>
                    <option value="è‡ºä¸­å¸‚">è‡ºä¸­å¸‚</option>
                    <option value="è‡ºå—å¸‚">è‡ºå—å¸‚</option>
                    <option value="é«˜é›„å¸‚">é«˜é›„å¸‚</option>
                    <option value="åŸºéš†å¸‚">åŸºéš†å¸‚</option>
                    <option value="æ–°ç«¹å¸‚">æ–°ç«¹å¸‚</option>
                    <option value="å˜‰ç¾©å¸‚">å˜‰ç¾©å¸‚</option>
                    <option value="å®œè˜­ç¸£">å®œè˜­ç¸£</option>
                    <option value="æ–°ç«¹ç¸£">æ–°ç«¹ç¸£</option>
                    <option value="è‹—æ —ç¸£">è‹—æ —ç¸£</option>
                    <option value="å½°åŒ–ç¸£">å½°åŒ–ç¸£</option>
                    <option value="å—æŠ•ç¸£">å—æŠ•ç¸£</option>
                    <option value="é›²æ—ç¸£">é›²æ—ç¸£</option>
                    <option value="å˜‰ç¾©ç¸£">å˜‰ç¾©ç¸£</option>
                    <option value="å±æ±ç¸£">å±æ±ç¸£</option>
                    <option value="èŠ±è“®ç¸£">èŠ±è“®ç¸£</option>
                    <option value="è‡ºæ±ç¸£">è‡ºæ±ç¸£</option>
                    <option value="æ¾æ¹–ç¸£">æ¾æ¹–ç¸£</option>
                    <option value="é‡‘é–€ç¸£">é‡‘é–€ç¸£</option>
                    <option value="é€£æ±Ÿç¸£">é€£æ±Ÿç¸£</option>
                </select>
                <select class="filter-select" id="filterSpecialty">
                    <option value="">è«‹é¸æ“‡ç§‘åˆ¥</option>
                    <option value="å°å…’ç§‘">å°å…’ç§‘</option>
                    <option value="å®¶é†«ç§‘">å®¶é†«ç§‘</option>
                    <option value="è€³é¼»å–‰ç§‘">è€³é¼»å–‰ç§‘</option>
                    <option value="å…§ç§‘">å…§ç§‘</option>
                    <option value="å¤–ç§‘">å¤–ç§‘</option>
                    <option value="å©¦ç”¢ç§‘">å©¦ç”¢ç§‘</option>
                    <option value="çš®è†šç§‘">çš®è†šç§‘</option>
                    <option value="æ³Œå°¿ç§‘">æ³Œå°¿ç§‘</option>
                    <option value="ç²¾ç¥ç§‘">ç²¾ç¥ç§‘</option>
                    <option value="ä¸­é†«">ä¸­é†«</option>
                </select>
                <button class="btn-add" onclick="showAddModal()">â• æ–°å¢è¨ºæ‰€</button>
                <button class="btn-delete-batch" onclick="deleteSelected()" id="btnDeleteBatch" style="display: none;">ğŸ—‘ï¸ åˆªé™¤é¸ä¸­</button>
                <button class="btn-export" onclick="exportData()">ğŸ“¥ åŒ¯å‡º Excel</button>
                <button class="btn-import" onclick="showImportModal()">ğŸ“¤ åŒ¯å…¥ Excel</button>
            </div>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th><input type="checkbox" id="selectAll" class="checkbox-select" title="å…¨é¸"></th>
                        <th>ç·¨è™Ÿ</th>
                        <th>ç¸£å¸‚</th>
                        <th>å€åŸŸ</th>
                        <th>è¨ºæ‰€åç¨±</th>
                        <th>ç§‘åˆ¥</th>
                        <th>é›»è©±</th>
                        <th>è² è²¬äºº</th>
                        <th>åª’é«”é …ç›®</th>
                        <th>å¥åº·é†«è³¼</th>
                        <th>ç™¾ä½</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="clinicsTable">
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modalçœç•¥ï¼Œèˆ‡ä¹‹å‰ç›¸åŒ -->
    <div class="modal" id="clinicModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">æ–°å¢è¨ºæ‰€</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="clinicForm">
                <input type="hidden" id="clinicId">
                
                <div class="form-group">
                    <label>ç¸£å¸‚ *</label>
                    <select id="region" required>
                        <option value="">è«‹é¸æ“‡ç¸£å¸‚</option>
                        <option value="è‡ºåŒ—å¸‚">è‡ºåŒ—å¸‚</option>
                        <option value="æ–°åŒ—å¸‚">æ–°åŒ—å¸‚</option>
                        <option value="æ¡ƒåœ’å¸‚">æ¡ƒåœ’å¸‚</option>
                        <option value="è‡ºä¸­å¸‚">è‡ºä¸­å¸‚</option>
                        <option value="è‡ºå—å¸‚">è‡ºå—å¸‚</option>
                        <option value="é«˜é›„å¸‚">é«˜é›„å¸‚</option>
                        <option value="åŸºéš†å¸‚">åŸºéš†å¸‚</option>
                        <option value="æ–°ç«¹å¸‚">æ–°ç«¹å¸‚</option>
                        <option value="å˜‰ç¾©å¸‚">å˜‰ç¾©å¸‚</option>
                        <option value="å®œè˜­ç¸£">å®œè˜­ç¸£</option>
                        <option value="æ–°ç«¹ç¸£">æ–°ç«¹ç¸£</option>
                        <option value="è‹—æ —ç¸£">è‹—æ —ç¸£</option>
                        <option value="å½°åŒ–ç¸£">å½°åŒ–ç¸£</option>
                        <option value="å—æŠ•ç¸£">å—æŠ•ç¸£</option>
                        <option value="é›²æ—ç¸£">é›²æ—ç¸£</option>
                        <option value="å˜‰ç¾©ç¸£">å˜‰ç¾©ç¸£</option>
                        <option value="å±æ±ç¸£">å±æ±ç¸£</option>
                        <option value="èŠ±è“®ç¸£">èŠ±è“®ç¸£</option>
                        <option value="è‡ºæ±ç¸£">è‡ºæ±ç¸£</option>
                        <option value="æ¾æ¹–ç¸£">æ¾æ¹–ç¸£</option>
                        <option value="é‡‘é–€ç¸£">é‡‘é–€ç¸£</option>
                        <option value="é€£æ±Ÿç¸£">é€£æ±Ÿç¸£</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>å€åŸŸ *</label>
                    <input type="text" id="district" required placeholder="ä¾‹å¦‚ï¼šå¤§å®‰å€ã€æ¿æ©‹å€">
                </div>

                <div class="form-group">
                    <label>è¨ºæ‰€åç¨± *</label>
                    <input type="text" id="name" required>
                </div>

                <div class="form-group">
                    <label>åœ°å€</label>
                    <input type="text" id="address" placeholder="ä¾‹å¦‚ï¼šå°åŒ—å¸‚å¤§å®‰å€ä¿¡ç¾©è·¯ä¸‰æ®µ123è™Ÿ">
                </div>

                <div class="form-group">
                    <label>é›»è©± *</label>
                    <input type="text" id="phone" required>
                </div>

                <div class="form-group">
                    <label>è² è²¬äºº *</label>
                    <input type="text" id="contactPerson" required>
                </div>

                <div class="form-group">
                    <label>ç§‘åˆ¥ *ï¼ˆå¯è¤‡é¸ï¼‰</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" value="å°å…’ç§‘"> å°å…’ç§‘</label>
                        <label><input type="checkbox" value="å®¶é†«ç§‘"> å®¶é†«ç§‘</label>
                        <label><input type="checkbox" value="è€³é¼»å–‰ç§‘"> è€³é¼»å–‰ç§‘</label>
                        <label><input type="checkbox" value="å…§ç§‘"> å…§ç§‘</label>
                        <label><input type="checkbox" value="å¤–ç§‘"> å¤–ç§‘</label>
                        <label><input type="checkbox" value="å©¦ç”¢ç§‘"> å©¦ç”¢ç§‘</label>
                        <label><input type="checkbox" value="çš®è†šç§‘"> çš®è†šç§‘</label>
                        <label><input type="checkbox" value="æ³Œå°¿ç§‘"> æ³Œå°¿ç§‘</label>
                        <label><input type="checkbox" value="ç²¾ç¥ç§‘"> ç²¾ç¥ç§‘</label>
                        <label><input type="checkbox" value="ä¸­é†«"> ä¸­é†«</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>åª’é«”é …ç›® *ï¼ˆå¯è¤‡é¸ï¼‰</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" value="è—¥è¢‹" class="media-item"> è—¥è¢‹</label>
                        <label><input type="checkbox" value="æµ·å ±" class="media-item"> æµ·å ±</label>
                        <label><input type="checkbox" value="æ«ƒæª¯" class="media-item"> æ«ƒæª¯</label>
                        <label><input type="checkbox" value="æ´¾æ¨£" class="media-item"> æ´¾æ¨£</label>
                        <label><input type="checkbox" value="å…¨é¸" class="media-item" id="mediaAll"> å…¨é¸</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>å¥åº·é†«è³¼ *</label>
                    <select id="healthMall" required>
                        <option value="å¦">å¦</option>
                        <option value="æ˜¯">æ˜¯</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ç™¾ä½ *</label>
                    <select id="hundredPosition" required>
                        <option value="å¦">å¦</option>
                        <option value="æ˜¯">æ˜¯</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ç‡Ÿæ¥­æ™‚é–“</label>
                    <textarea id="businessHours" placeholder="ä¾‹å¦‚ï¼šé€±ä¸€è‡³é€±äº” 09:00-21:00"></textarea>
                </div>

                <div class="form-group">
                    <label>å‚™è¨»</label>
                    <textarea id="note" placeholder="è«‹è¼¸å…¥å‚™è¨»è³‡è¨Š..."></textarea>
                </div>

                <button type="submit" class="btn-submit">å„²å­˜</button>
            </form>
        </div>
    </div>

    <script>
        let currentEditId = null;

        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            loadClinics();
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', loadClinics);
            document.getElementById('filterRegion').addEventListener('change', loadClinics);
            document.getElementById('filterSpecialty').addEventListener('change', loadClinics);
            document.getElementById('clinicForm').addEventListener('submit', handleSubmit);
            
            // å…¨é¸åŠŸèƒ½ï¼ˆä½¿ç”¨äº‹ä»¶å§”æ´¾ï¼Œå› ç‚ºè¡¨æ ¼æ˜¯å‹•æ…‹ç”Ÿæˆçš„ï¼‰
            document.addEventListener('change', function(e) {
                if (e.target.id === 'selectAll') {
                    const checkboxes = document.querySelectorAll('.clinic-checkbox');
                    checkboxes.forEach(cb => cb.checked = e.target.checked);
                    updateDeleteButton();
                } else if (e.target.classList.contains('clinic-checkbox')) {
                    updateSelectAllState();
                    updateDeleteButton();
                }
            });
            
            // åª’é«”é …ç›®ã€Œå…¨é¸ã€çš„é‚è¼¯
            const mediaAllCheckbox = document.getElementById('mediaAll');
            if (mediaAllCheckbox) {
                mediaAllCheckbox.addEventListener('change', function() {
                    const mediaItems = document.querySelectorAll('.media-item:not(#mediaAll)');
                    if (this.checked) {
                        mediaItems.forEach(item => item.checked = true);
                    }
                });
                
                // ç•¶å…¶ä»–åª’é«”é …ç›®å–æ¶ˆé¸ä¸­æ™‚ï¼Œå–æ¶ˆã€Œå…¨é¸ã€
                document.querySelectorAll('.media-item:not(#mediaAll)').forEach(item => {
                    item.addEventListener('change', function() {
                        if (!this.checked) {
                            mediaAllCheckbox.checked = false;
                        } else {
                            // æª¢æŸ¥æ˜¯å¦æ‰€æœ‰é …ç›®éƒ½å·²é¸ä¸­
                            const allChecked = Array.from(document.querySelectorAll('.media-item:not(#mediaAll)')).every(cb => cb.checked);
                            if (allChecked) {
                                mediaAllCheckbox.checked = true;
                            }
                        }
                    });
                });
            }
        }
        
        function updateSelectAllState() {
            const checkboxes = document.querySelectorAll('.clinic-checkbox');
            const selectAll = document.getElementById('selectAll');
            if (checkboxes.length === 0) {
                if (selectAll) selectAll.checked = false;
                return;
            }
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            const someChecked = Array.from(checkboxes).some(cb => cb.checked);
            if (selectAll) {
                selectAll.checked = allChecked;
                selectAll.indeterminate = someChecked && !allChecked;
            }
        }
        
        function updateDeleteButton() {
            const checkedBoxes = document.querySelectorAll('.clinic-checkbox:checked');
            const deleteBtn = document.getElementById('btnDeleteBatch');
            if (deleteBtn) {
                if (checkedBoxes.length > 0) {
                    deleteBtn.style.display = 'inline-block';
                } else {
                    deleteBtn.style.display = 'none';
                }
            }
        }
        
        async function deleteSelected() {
            const checkedBoxes = document.querySelectorAll('.clinic-checkbox:checked');
            if (checkedBoxes.length === 0) {
                alert('è«‹é¸æ“‡è¦åˆªé™¤çš„è¨ºæ‰€');
                return;
            }
            
            const selectedIds = Array.from(checkedBoxes).map(cb => cb.getAttribute('data-clinic-id'));
            const count = selectedIds.length;
            
            if (!confirm(`ç¢ºå®šè¦åˆªé™¤é¸ä¸­çš„ ${count} ç­†è¨ºæ‰€è³‡æ–™å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚`)) {
                return;
            }
            
            try {
                // æ‰¹é‡åˆªé™¤
                const deletePromises = selectedIds.map(id => 
                    fetch(`/api/clinics/${id}`, { method: 'DELETE' })
                );
                
                const results = await Promise.all(deletePromises);
                const failed = results.filter(r => !r.ok);
                
                if (failed.length > 0) {
                    alert(`åˆªé™¤å®Œæˆï¼Œä½†æœ‰ ${failed.length} ç­†è³‡æ–™åˆªé™¤å¤±æ•—`);
                } else {
                    alert(`æˆåŠŸåˆªé™¤ ${count} ç­†è³‡æ–™`);
                }
                
                // é‡æ–°è¼‰å…¥è³‡æ–™
                loadStats();
                loadClinics();
                const selectAll = document.getElementById('selectAll');
                if (selectAll) selectAll.checked = false;
                updateDeleteButton();
            } catch (error) {
                console.error('æ‰¹é‡åˆªé™¤å¤±æ•—:', error);
                alert('æ‰¹é‡åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
            }
        }

        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();
                document.getElementById('totalClinics').textContent = data.total;
                document.getElementById('healthMallYes').textContent = data.health_mall_yes;
                document.getElementById('healthMallNo').textContent = data.health_mall_no;
            } catch (error) {
                console.error('è¼‰å…¥çµ±è¨ˆè³‡æ–™å¤±æ•—:', error);
            }
        }

        async function loadClinics() {
            const search = document.getElementById('searchInput').value;
            const region = document.getElementById('filterRegion').value;
            const specialty = document.getElementById('filterSpecialty').value;

            const params = new URLSearchParams();
            if (search) params.append('search', search);
            if (region) params.append('region', region);
            if (specialty) params.append('specialty', specialty);

            try {
                const response = await fetch(`/api/clinics?${params}`);
                const clinics = await response.json();
                displayClinics(clinics);
            } catch (error) {
                console.error('è¼‰å…¥è¨ºæ‰€è³‡æ–™å¤±æ•—:', error);
            }
        }

        function displayClinics(clinics) {
            const tbody = document.getElementById('clinicsTable');
            tbody.innerHTML = '';

            clinics.forEach((clinic, index) => {
                const row = document.createElement('tr');
                row.setAttribute('data-clinic-id', clinic.id);
                
                // è‡ªå‹•ç·¨è™Ÿï¼ˆå¾1é–‹å§‹ï¼‰
                const displayNumber = index + 1;
                
                const specialties = clinic.specialties ? clinic.specialties.split(',').map(s => 
                    `<span class="specialty-tag">${s.trim()}</span>`
                ).join(' ') : '';

                const mediaItems = clinic.media_items ? clinic.media_items.split(',').map(m => 
                    `<span class="specialty-tag" style="background: #fff3cd; color: #856404;">${m.trim()}</span>`
                ).join(' ') : 'ç„¡';

                const healthMallValue = clinic.health_mall || 'å¦';
                const hundredPositionValue = clinic.hundred_position || 'å¦';
                const healthMallTag = `<span class="status-tag ${healthMallValue === 'æ˜¯' ? 'yes' : 'no'}">${healthMallValue}</span>`;
                const hundredPositionTag = `<span class="status-tag ${hundredPositionValue === 'æ˜¯' ? 'yes' : 'no'}">${hundredPositionValue}</span>`;
                
                row.innerHTML = `
                    <td><input type="checkbox" class="checkbox-select clinic-checkbox" data-clinic-id="${clinic.id}"></td>
                    <td>${displayNumber}</td>
                    <td>${clinic.region || ''}</td>
                    <td>${clinic.district || ''}</td>
                    <td title="${clinic.name}">${clinic.name}</td>
                    <td>${specialties}</td>
                    <td>${clinic.phone || ''}</td>
                    <td>${clinic.contact_person || ''}</td>
                    <td>${mediaItems}</td>
                    <td>${healthMallTag}</td>
                    <td>${hundredPositionTag}</td>
                    <td>
                        <button class="btn-edit" onclick="editClinic(${clinic.id})">ç·¨è¼¯</button>
                        <button class="btn-detail" onclick="toggleDetail(${clinic.id})">è©³ç´°</button>
                    </td>
                `;
                tbody.appendChild(row);

                // å‰µå»ºè©³ç´°è³‡è¨Šè¡Œ
                const detailRow = document.createElement('tr');
                detailRow.className = 'detail-row';
                detailRow.setAttribute('data-detail-for', clinic.id);
                detailRow.innerHTML = `
                    <td colspan="12">
                        <div class="detail-content">
                            <h4>è©³ç´°è³‡è¨Š</h4>
                            <div class="detail-info">
                                <div class="detail-item">
                                    <label>åœ°å€</label>
                                    <span>${clinic.address || 'æœªè¨­å®š'}</span>
                                </div>
                                <div class="detail-item">
                                    <label>ç‡Ÿæ¥­æ™‚é–“</label>
                                    <span>${clinic.business_hours || 'æœªè¨­å®š'}</span>
                                </div>
                                <div class="detail-item">
                                    <label>å‚™è¨»</label>
                                    <span>${clinic.note || 'ç„¡å‚™è¨»'}</span>
                                </div>
                            </div>
                        </div>
                    </td>
                `;
                tbody.appendChild(detailRow);
            });
        }

        function toggleDetail(clinicId) {
            const detailRow = document.querySelector(`tr[data-detail-for="${clinicId}"]`);
            if (!detailRow) return;

            // é—œé–‰å…¶ä»–å·²å±•é–‹çš„è©³ç´°è³‡è¨Š
            document.querySelectorAll('.detail-row.active').forEach(row => {
                if (row !== detailRow) {
                    row.classList.remove('active');
                }
            });

            // åˆ‡æ›ç•¶å‰è©³ç´°è³‡è¨Šçš„é¡¯ç¤ºç‹€æ…‹
            detailRow.classList.toggle('active');
        }

        function showAddModal() {
            currentEditId = null;
            document.getElementById('modalTitle').textContent = 'æ–°å¢è¨ºæ‰€';
            document.getElementById('clinicForm').reset();
            document.getElementById('clinicId').value = '';
            document.getElementById('address').value = '';
            document.querySelectorAll('.checkbox-group input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
            document.getElementById('clinicModal').style.display = 'block';
        }

        async function editClinic(id) {
            currentEditId = id;
            document.getElementById('modalTitle').textContent = 'ç·¨è¼¯è¨ºæ‰€';

            try {
                const response = await fetch(`/api/clinics?search=`);
                const clinics = await response.json();
                const clinic = clinics.find(c => c.id === id);

                if (clinic) {
                    document.getElementById('clinicId').value = clinic.id;
                    document.getElementById('region').value = clinic.region || '';
                    document.getElementById('district').value = clinic.district || '';
                    document.getElementById('name').value = clinic.name || '';
                    document.getElementById('healthMall').value = clinic.health_mall || 'å¦';
                    document.getElementById('hundredPosition').value = clinic.hundred_position || 'å¦';
                    document.getElementById('address').value = clinic.address || '';
                    document.getElementById('phone').value = clinic.phone || '';
                    document.getElementById('contactPerson').value = clinic.contact_person || '';
                    document.getElementById('businessHours').value = clinic.business_hours || '';
                    document.getElementById('note').value = clinic.note || '';

                    const specialties = clinic.specialties ? clinic.specialties.split(',').map(s => s.trim()) : [];
                    document.querySelectorAll('.checkbox-group input[type="checkbox"]:not(.media-item)').forEach(cb => {
                        cb.checked = specialties.includes(cb.value);
                    });

                    const mediaItems = clinic.media_items ? clinic.media_items.split(',').map(m => m.trim()) : [];
                    // å¦‚æœåŒ…å«ã€Œå…¨éƒ¨ã€æˆ–ã€Œå…¨é¸ã€ï¼Œå‰‡é¸ä¸­æ‰€æœ‰é …ç›®
                    const hasAll = mediaItems.includes('å…¨éƒ¨') || mediaItems.includes('å…¨é¸');
                    document.querySelectorAll('.media-item:not(#mediaAll)').forEach(cb => {
                        cb.checked = hasAll || mediaItems.includes(cb.value);
                    });
                    // å¦‚æœæ‰€æœ‰é …ç›®éƒ½è¢«é¸ä¸­ï¼Œå‰‡é¸ä¸­ã€Œå…¨é¸ã€
                    if (hasAll) {
                        document.getElementById('mediaAll').checked = true;
                    }

                    document.getElementById('clinicModal').style.display = 'block';
                }
            } catch (error) {
                console.error('è¼‰å…¥è¨ºæ‰€è³‡æ–™å¤±æ•—:', error);
                alert('è¼‰å…¥è¨ºæ‰€è³‡æ–™å¤±æ•—');
            }
        }

        async function handleSubmit(e) {
            e.preventDefault();

            const selectedSpecialties = Array.from(
                document.querySelectorAll('.checkbox-group input[type="checkbox"]:not(.media-item):checked')
            ).map(cb => cb.value).join(',');

            const selectedMediaItems = Array.from(
                document.querySelectorAll('.media-item:checked')
            )
            .filter(cb => cb.value !== 'å…¨é¸') // æ’é™¤ã€Œå…¨é¸ã€é¸é …ï¼Œä¸æäº¤åˆ°è³‡æ–™åº«
            .map(cb => cb.value).join(',');

            const clinicData = {
                region: document.getElementById('region').value,
                district: document.getElementById('district').value,
                name: document.getElementById('name').value,
                health_mall: document.getElementById('healthMall').value,
                hundred_position: document.getElementById('hundredPosition').value,
                media_items: selectedMediaItems,
                specialties: selectedSpecialties,
                address: document.getElementById('address').value,
                phone: document.getElementById('phone').value,
                contact_person: document.getElementById('contactPerson').value,
                business_hours: document.getElementById('businessHours').value,
                note: document.getElementById('note').value
            };

            try {
                const id = document.getElementById('clinicId').value;
                const url = id ? `/api/clinics/${id}` : '/api/clinics';
                const method = id ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(clinicData)
                });

                if (response.ok) {
                    closeModal();
                    loadStats();
                    loadClinics();
                } else {
                    const errorData = await response.json().catch(() => ({ error: 'å„²å­˜å¤±æ•—' }));
                    console.error('å„²å­˜å¤±æ•—:', errorData);
                    alert(errorData.error || 'å„²å­˜å¤±æ•—');
                }
            } catch (error) {
                console.error('å„²å­˜å¤±æ•—:', error);
                alert('å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦: ' + error.message);
            }
        }

        async function deleteClinic(id) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹è¨ºæ‰€å—ï¼Ÿ')) {
                return;
            }

            try {
                const response = await fetch(`/api/clinics/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    loadStats();
                    loadClinics();
                } else {
                    const error = await response.json();
                    alert(error.error || 'åˆªé™¤å¤±æ•—');
                }
            } catch (error) {
                console.error('åˆªé™¤å¤±æ•—:', error);
                alert('åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
            }
        }

        function closeModal() {
            document.getElementById('clinicModal').style.display = 'none';
        }

        function logout() {
            window.location.href = '/logout';
        }

        window.onclick = function(event) {
            const modal = document.getElementById('clinicModal');
            if (event.target == modal) {
                closeModal();
            }
            const importModal = document.getElementById('importModal');
            if (event.target == importModal) {
                closeImportModal();
            }
        }

        // åŒ¯å‡ºåŠŸèƒ½
        function exportData() {
            const search = document.getElementById('searchInput').value;
            const region = document.getElementById('filterRegion').value;
            const specialty = document.getElementById('filterSpecialty').value;
            const mediaItem = document.getElementById('filterMediaItem') ? document.getElementById('filterMediaItem').value : '';
            
            const params = new URLSearchParams();
            if (search) params.append('search', search);
            if (region) params.append('region', region);
            if (specialty) params.append('specialty', specialty);
            if (mediaItem) params.append('media_item', mediaItem);
            
            // ç”¢ç”Ÿä¸‹è¼‰é€£çµ
            const url = `/api/export?${params}`;
            window.location.href = url;
        }

        // é¡¯ç¤ºåŒ¯å…¥ Modal
        function showImportModal() {
            document.getElementById('importModal').style.display = 'block';
            document.getElementById('importFile').value = '';
            document.getElementById('importResult').style.display = 'none';
        }

        // é—œé–‰åŒ¯å…¥ Modal
        function closeImportModal() {
            document.getElementById('importModal').style.display = 'none';
        }

        // ä¸Šå‚³æª”æ¡ˆ
        async function uploadFile() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('è«‹é¸æ“‡æª”æ¡ˆ');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                const response = await fetch('/api/import', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                const resultDiv = document.getElementById('importResult');
                
                if (result.success) {
                    resultDiv.innerHTML = `
                        <div style="background: #d4edda; color: #155724; padding: 15px; border-radius: 8px;">
                            <strong>âœ… åŒ¯å…¥æˆåŠŸ</strong><br>
                            æˆåŠŸåŒ¯å…¥ ${result.imported} ç­†è³‡æ–™
                            ${result.errors.length > 0 ? '<br><br>éŒ¯èª¤ï¼š<br>' + result.errors.join('<br>') : ''}
                        </div>
                    `;
                    resultDiv.style.display = 'block';
                    
                    // é‡æ–°è¼‰å…¥è³‡æ–™
                    setTimeout(() => {
                        closeImportModal();
                        loadClinics();
                        loadStats();
                    }, 2000);
                } else {
                    resultDiv.innerHTML = `
                        <div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 8px;">
                            <strong>âŒ åŒ¯å…¥å¤±æ•—</strong><br>
                            ${result.error}
                        </div>
                    `;
                    resultDiv.style.display = 'block';
                }
            } catch (error) {
                alert('åŒ¯å…¥å¤±æ•—ï¼š' + error);
            }
        }
    </script>

    <!-- åŒ¯å…¥ Modal -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“¤ åŒ¯å…¥è¨ºæ‰€è³‡æ–™</h2>
                <button class="close-btn" onclick="closeImportModal()">&times;</button>
            </div>
            <div style="margin-bottom: 20px;">
                <p style="color: #666; font-size: 14px;">
                    ğŸ“‹ æª”æ¡ˆæ ¼å¼è¦æ±‚ï¼š<br>
                    â€¢ å¿…é ˆæ˜¯ .xlsx æ ¼å¼<br>
                    â€¢ æ¬„ä½é †åºï¼šç¸£å¸‚ã€å€åŸŸã€è¨ºæ‰€åç¨±ã€ç§‘åˆ¥ã€åœ°å€ã€é›»è©±ã€è² è²¬äºº<br>
                    â€¢ è¨ºæ‰€åç¨±ç‚ºå¿…å¡«æ¬„ä½
                </p>
            </div>
            <div class="form-group">
                <label>é¸æ“‡ Excel æª”æ¡ˆ</label>
                <input type="file" id="importFile" accept=".xlsx" style="padding: 10px; border: 2px dashed #e0e0e0; border-radius: 8px;">
            </div>
            <button class="btn-submit" onclick="uploadFile()">é–‹å§‹åŒ¯å…¥</button>
            <div id="importResult" style="margin-top: 20px; display: none;"></div>
        </div>
    </div>
</body>
</html>
